<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Osha's School</title>
    <style>
        :root { --osha-pink: #FF85A1; --osha-blue: #4DB8FF; --osha-yellow: #FFD700; --osha-green: #63D471; --osha-purple: #B19BFE; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; margin: 0; padding: 0; }
        body { width: 100vw; height: 100vh; overflow: hidden; background: #FFFBF2; font-family: 'Comic Sans MS', sans-serif; touch-action: none; }
        
        #starter { position: fixed; inset: 0; background: var(--osha-pink); z-index: 9999; display: flex; flex-direction: column; justify-content: center; align-items: center; color: white; text-align: center; }

        #nav { height: 10%; width: 100%; background: white; border-bottom: 4px solid var(--osha-blue); display: flex; justify-content: space-around; align-items: center; z-index: 1000; }
        .nav-btn { border: none; border-radius: 12px; color: white; font-weight: 900; font-size: 14px; padding: 8px 12px; box-shadow: 0 4px #ddd; }

        .screen { height: 90%; width: 100%; display: none; flex-direction: column; align-items: center; justify-content: flex-start; padding-top: 20px; position: relative; }
        .active { display: flex; }

        .falling-item { position: absolute; width: 85px; height: 85px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 45px; border: 4px solid white; box-shadow: 0 4px 10px rgba(0,0,0,0.1); z-index: 5; }
        
        .target-card { width: 180px; height: 260px; border: 8px solid var(--osha-blue); border-radius: 40px; background: white; display: flex; align-items: center; justify-content: center; font-size: 140px; font-weight: 900; color: var(--osha-pink); margin-bottom: 40px; box-shadow: 0 10px 0 #E0E0E0; }
        .choice-btn { width: 85px; height: 85px; background: #F2F2F2; border: 3px solid #333; border-radius: 25px; font-size: 40px; font-weight: bold; box-shadow: 0 6px 0 #ccc; }

        .tool-bar { display: flex; overflow-x: auto; width: 100%; padding: 10px; gap: 8px; background: white; }
        .color-dot { min-width: 38px; height: 38px; border-radius: 50%; border: 2px solid #ddd; flex-shrink: 0; }
        .stamp-btn { font-size: 32px; border: none; background: none; min-width: 48px; }
        .trace-grid { display: grid; grid-template-columns: repeat(6, 1fr); gap: 8px; padding: 10px; width: 100%; height: 75%; overflow-y: auto; }
        .trace-item { background: white; border-radius: 12px; border: 2px solid #ddd; height: 55px; display: flex; align-items: center; justify-content: center; font-size: 22px; font-weight: bold; }
        .canvas-area { position: relative; width: 95%; height: 60%; background: white; border-radius: 30px; border: 5px solid #EEE; overflow: hidden; }
        canvas { width: 100%; height: 100%; z-index: 2; position: relative; }
        .hint { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; font-size: 250px; color: #F6F6F6; z-index: 1; pointer-events: none; }

        .box-wrap { display: flex; gap: 12px; margin-top: 50px; }
        .peek-box { width: 100px; height: 100px; background: var(--osha-pink); border: 5px solid white; border-radius: 20px; color: white; font-size: 45px; display: flex; align-items: center; justify-content: center; z-index: 10; position: relative; }
        .animal { position: absolute; top: 0; left: 0; width: 100%; height: 100%; font-size: 70px; display: flex; align-items: center; justify-content: center; opacity: 0; transition: 0.5s; }
        .revealed { opacity: 1 !important; transform: translateY(-80px) scale(1.4); }
        .shaking { animation: shake 0.5s infinite; background: var(--osha-yellow); }
        @keyframes shake { 0%, 100% { transform: rotate(0); } 25% { transform: rotate(5deg); } 75% { transform: rotate(-5deg); } }
    </style>
</head>
<body onload="welcome()">

<div id="starter" onclick="begin()">
    <h1>Osha's School</h1>
    <p style="font-size: 24px; font-weight: bold;">Tap to Play</p>
</div>

<div id="nav">
    <button class="nav-btn" style="background:var(--osha-pink)" onclick="go('num')">123</button>
    <button class="nav-btn" style="background:var(--osha-yellow); color:#333;" onclick="go('abc')">ABC</button>
    <button class="nav-btn" style="background:var(--osha-green)" onclick="go('peek')">Peek</button>
    <button class="nav-btn" style="background:var(--osha-purple)" onclick="go('menu')">Trace</button>
    <button class="nav-btn" style="background:var(--osha-blue)" onclick="go('all')">üçéüç±</button>
</div>

<div id="num-screen" class="screen"><div class="target-card" id="target-n">1</div><div style="display:flex; gap:15px;" id="choices-n"></div></div>
<div id="abc-screen" class="screen"><div class="target-card" id="target-a">A</div><div style="display:flex; gap:15px;" id="choices-a"></div></div>

<div id="menu-screen" class="screen"><div id="trace-list" class="trace-grid"></div></div>
<div id="trace-screen" class="screen">
    <div class="tool-bar" id="c-bar"></div>
    <div class="tool-bar" id="s-bar"></div>
    <div class="canvas-area"><div id="hint-text" class="hint"></div><canvas id="c"></canvas></div>
    <button onclick="clearTrace()" style="margin-top:10px; padding:10px 20px; background:white; border-radius:15px;">Clear</button>
</div>

<div id="peek-screen" class="screen">
    <div class="box-wrap">
        <div style="position:relative;"><div class="animal" id="ani-0"></div><div class="peek-box" id="box-0" onclick="openBox(0)">?</div></div>
        <div style="position:relative;"><div class="animal" id="ani-1"></div><div class="peek-box" id="box-1" onclick="openBox(1)">?</div></div>
        <div style="position:relative;"><div class="animal" id="ani-2"></div><div class="peek-box" id="box-2" onclick="openBox(2)">?</div></div>
    </div>
    <button onclick="resetPeek()" style="margin-top:130px; padding:15px; background:var(--osha-green); color:white; border-radius:20px;">Next!</button>
</div>

<div id="all-screen" class="screen"><div id="all-zone" style="width:100%; height:100%; position:relative; overflow:hidden;"></div></div>

<script>
    const name = "Osha";
    let canvas, ctx, painting = false, brush = 'color', val = '#333', loop, canPeek = true, winBox = -1;

    const colors = ["#FF85A1","#4DB8FF","#63D471","#FFD700","#B19BFE","#FF9F43","#EE5253","#00D2FF","#00B894","#6C5CE7","#3F37C9","#2D3436","#EF5DA8","#FFADE1","#00CEC9"];
    const stamps = ["üê∂","üê±","ü¶Å","üê∞","üêº","üê•","üêô","üêü","üêã","ü¶ã"];
    // Combined agreed list
    const masterList = [
        {e:"üçé",n:"Apple",a:"ÿ™ŸÅÿßÿ≠ÿ©"},{e:"üçå",n:"Banana",a:"ŸÖŸàÿ≤"},{e:"ü•õ",n:"Milk",a:"ÿ≠ŸÑŸäÿ®"},
        {e:"üç≥",n:"Egg",a:"ÿ®Ÿäÿ∂"},{e:"ü•¶",n:"Broccoli",a:"ÿ®ÿ±ŸàŸÉŸÑŸä"},{e:"üçû",n:"Bread",a:"ÿÆÿ®ÿ≤"},
        {e:"üçì",n:"Strawberry",a:"ŸÅÿ±ÿßŸàŸÑÿ©"},{e:"ü•ï",n:"Carrot",a:"ÿ¨ÿ≤ÿ±"},{e:"üçó",n:"Chicken",a:"ÿØÿ¨ÿßÿ¨"},
        {e:"üíß",n:"Water",a:"ŸÖÿßÿ°"},{e:"üçù",n:"Pasta",a:"ŸÖŸÉÿ±ŸàŸÜÿ©"},{e:"üçü",n:"Fries",a:"ÿ®ÿ∑ÿßÿ∑ÿ≥"}
    ];

    function talk(t, l="en-US") { window.speechSynthesis.cancel(); let m = new SpeechSynthesisUtterance(t); m.lang=l; m.rate=0.8; window.speechSynthesis.speak(m); }
    function pop() { new Audio("https://actions.google.com/sounds/v1/cartoon/pop.ogg").play().catch(()=>{}); }

    function welcome() { talk("Come on Osha, let's start"); }

    function begin() {
        document.getElementById('starter').style.display='none';
        canvas = document.getElementById('c'); ctx = canvas.getContext('2d');
        setupTrace(); go('num');
    }

    function setupTrace() {
        const cb = document.getElementById('c-bar'); colors.forEach(c => {
            let d = document.createElement('div'); d.className='color-dot'; d.style.background=c;
            d.onclick=()=>{ brush='color'; val=c; talk("Color"); }; cb.appendChild(d);
        });
        const sb = document.getElementById('s-bar'); stamps.forEach(s => {
            let b = document.createElement('button'); b.className='stamp-btn'; b.innerText=s;
            b.onclick=()=>{ brush='stamp'; val=s; talk("Sticker"); }; sb.appendChild(b);
        });
        const list = document.getElementById('trace-list');
        [...Array(10).keys()].map(n => (n+1).toString()).concat("ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("")).forEach(i => {
            let it = document.createElement('div'); it.className='trace-item'; it.innerText=i;
            it.onclick=()=>{ document.getElementById('hint-text').innerText=i; talk(i); ctx.clearRect(0,0,canvas.width,canvas.height); go('trace'); };
            list.appendChild(it);
        });
    }

    function go(s) {
        document.querySelectorAll('.screen').forEach(sc => sc.classList.remove('active'));
        document.getElementById(s+'-screen').classList.add('active');
        clearInterval(loop);
        if(s==='num'||s==='abc') setupMatch(s);
        if(s==='peek') resetPeek();
        if(s==='trace') { canvas.width=canvas.offsetWidth; canvas.height=canvas.offsetHeight; paint(); }
        if(s==='all') loop = setInterval(() => spawn(masterList, 'all-zone'), 1800);
    }

    function setupMatch(type) {
        const isN = type==='num';
        const list = isN ? ["1","2","3","4","5","6","7","8","9","10"] : "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");
        const goal = list[Math.floor(Math.random()*list.length)];
        document.getElementById(isN?'target-n':'target-a').innerText = goal;
        talk(`Find ${goal} Osha`);
        const area = document.getElementById(isN?'choices-n':'choices-a'); area.innerHTML="";
        let pool = [goal]; while(pool.length<3) { let r=list[Math.floor(Math.random()*list.length)]; if(!pool.includes(r)) pool.push(r); }
        pool.sort(()=>Math.random()-0.5).forEach(v => {
            let b = document.createElement('button'); b.className='choice-btn'; b.innerText=v;
            b.onclick=()=>{
                if(v==goal) { pop(); talk("Well done Osha!"); celebrate(); setTimeout(()=>setupMatch(type), 2000); }
                else talk("Try again Osha");
            };
            area.appendChild(b);
        });
    }

    function spawn(lib, zoneId) {
        const z = document.getElementById(zoneId); const d = lib[Math.floor(Math.random()*lib.length)];
        const el = document.createElement('div'); el.className='falling-item'; el.innerText=d.e; el.style.background=colors[Math.floor(Math.random()*colors.length)];
        el.style.left = Math.random()*(window.innerWidth-90)+'px'; el.style.top='-100px'; z.appendChild(el);
        let y = -100; const f = setInterval(() => { y+=1.5; el.style.top=y+'px'; if(y>window.innerHeight){el.remove(); clearInterval(f);} }, 16);
        el.onclick=()=>{ const ar=Math.random()>0.5; talk(ar?d.a:d.n, ar?"ar-SA":"en-US"); el.remove(); clearInterval(f); };
    }

    function resetPeek() {
        canPeek=true; winBox=Math.floor(Math.random()*3);
        const mix = [...stamps, ...masterList.map(m=>m.e)];
        for(let i=0; i<3; i++) {
            const b=document.getElementById('box-'+i); const a=document.getElementById('ani-'+i);
            b.classList.remove('shaking'); b.style.opacity="1"; a.classList.remove('revealed');
            if(i===winBox) { b.classList.add('shaking'); a.innerText=mix[Math.floor(Math.random()*mix.length)]; }
        }
    }

    function openBox(id) {
        if(!canPeek || id!==winBox) return;
        canPeek=false; pop(); document.getElementById('box-'+id).style.opacity="0";
        const char = document.getElementById('ani-'+id); char.classList.add('revealed');
        talk(char.innerText); celebrate();
    }

    function clearTrace() { ctx.clearRect(0,0,canvas.width,canvas.height); }

    function paint() {
        ctx.lineCap='round'; ctx.lineWidth=15;
        const draw=(e)=>{
            const r=canvas.getBoundingClientRect(); 
            const x=(e.touches?e.touches[0].clientX:e.clientX)-r.left; 
            const y=(e.touches?e.touches[0].clientY:e.clientY)-r.top;
            if(brush==='stamp' && (e.type==='touchstart' || e.type==='mousedown')){ 
                ctx.font="45px Arial"; ctx.fillText(val, x-22, y+22); 
            }
            else if(painting && brush==='color'){ ctx.lineTo(x,y); ctx.stroke(); }
        };
        canvas.onmousedown = canvas.ontouchstart = (e) => { 
            e.preventDefault(); 
            if(brush==='color'){ painting=true; ctx.beginPath(); ctx.strokeStyle=val; }
            draw(e); 
        };
        canvas.onmousemove = canvas.ontouchmove = (e) => { e.preventDefault(); draw(e); };
        window.onmouseup = window.ontouchend = () => { painting=false; };
    }

    function celebrate() { for(let i=0; i<6; i++) { let b=document.createElement('div'); b.innerText='üéà'; b.style.cssText=`position:fixed; bottom:-50px; left:${Math.random()*90}vw; font-size:55px; animation:up 3s forwards; z-index:10000;`; document.body.appendChild(b); setTimeout(()=>b.remove(),3000); } }
</script>
<style> @keyframes up { to { transform: translateY(-110vh); } } </style>
</body>
</html>
